<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>OCDots</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?" />

    <meta name="title" content="OCDots - Shake'em like nobody's watching" />
    <meta
      name="description"
      content="OCDots is a javascript library for creating evenly distributed points inside a polygon"
    />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://luxedo.github.io/OCDots/" />
    <meta
      property="og:title"
      content="OCDots - Shake'em like nobody's watching"
    />
    <meta
      property="og:description"
      content="OCDots is a javascript library for creating evenly distributed points inside a polygon"
    />
    <meta
      property="og:image"
      content="https://github.com/luxedo/OCDots/raw/master/docs/ocdots.gif"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="https://luxedo.github.io/OCDots/" />
    <meta name="twitter:creator" content="@_luxedo" />
    <meta
      name="twitter:title"
      content="OCDots - Shake'em like nobody's watching"
    />
    <meta name=twitter:description" content="OCDots is a javascript library for
    creating evenly distributed points inside a polygon" />
    <meta
      name="twitter:image"
      content="https://github.com/luxedo/OCDots/raw/master/docs/ocdots.gif"
    />

    <script src="ocdots.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container-fluid">
      <div class="row mt-3">
        <div class="col-sm-6 offset-sm-3 d-flex justify-content-center">
          <h1>OCDots</h1>
          <a class="ml-2" style="" href="https://github.com/luxedo/OCDots">
            <img src="GitHub-Mark-32px.png" /><span></span>
          </a>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6 offset-sm-3 d-flex justify-content-center">
          <em>Shake'em like nobody's watching</em>
        </div>
      </div>
      <div class="row mt-2">
        <div
          class="col-lg-4 offset-lg-4 col-sm-6 offset-sm-3 d-flex justify-content-center"
        >
          <canvas id="canvas" class="w-100 mx-5"></canvas>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-sm-6 offset-sm-3 col-md-4 offset-md-4">
          <div class="row justify-content-center">
            <div class="d-flex flex-column mx-1">
              <label for="baseForce">Base Force</label>
              <input
                type="range"
                class="form-control-range"
                id="baseForce"
                min="0"
                max="10"
                step="1"
                onchange="setValue('baseForce', this.value);"
              />
              <label for="baseForce" id="baseForceValue" , class="mx-1"></label>
            </div>
            <div class="d-flex flex-column mx-1">
              <label for="drag" class="ml-2">Drag</label>
              <input
                type="range"
                class="form-control-range ml-1"
                id="drag"
                min="0"
                max="0.2"
                step="0.005"
                onchange="setValue('drag', this.value);"
              />
              <label for="drag" id="dragValue" , class="mx-1"></label>
            </div>
            <div class="d-flex flex-column mx-1">
              <label for="viscosity">Viscosity</label>
              <input
                type="range"
                class="form-control-range ml-1"
                id="viscosity"
                min="0"
                max="20"
                step="0.1"
                onchange="setValue('viscosity', this.value);"
              />
              <label for="viscosity" id="viscosityValue" , class="mx-1"></label>
            </div>
            <div class="d-flex flex-column mx-1">
              <label for="maxMomentum" class="ml-2">Max Momentum</label>
              <input
                type="range"
                class="form-control-range ml-1"
                id="maxMomentum"
                min="1"
                max="50"
                step="1"
                onchange="setValue('maxMomentum', this.value);"
              />
              <label
                for="maxMomentum"
                id="maxMomentumValue"
                ,
                class="mx-1"
              ></label>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6 offset-sm-3 d-flex justify-content-center">
          <div class="row justify-content-center">
            <button
              class="btn btn-primary mx-2 align-self-end"
              onclick="resetControls()"
            >
              Reset Controls
            </button>
            <div class="d-flex flex-column mx-2">
              <label for="N" class="d-block ml-1 mb-0">Dots</label>
              <input
                type="number"
                class="form-control ml-1"
                style="max-width: 5em"
                id="N"
                max="300"
                min="1"
              />
            </div>
            <div class="row mt-2">
              <div class="col-sm-6 offset-sm-3 d-flex justify-content-center">
                <button
                  class="btn btn-success mx-2 align-self-end"
                  onclick="shakeem()"
                >
                  Shake'em
                </button>
                <button
                  class="btn btn-danger mx-2 px-4 align-self-end"
                  onclick="reset()"
                >
                  Reset
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-5 footer">
        <div class="col-sm-6 offset-sm-3 text-center">
          <p>
            Copyright (c) 2020 Luiz Eduardo Amaral -
            <a href="mailto:luizamaral306@gmail.com?Subject=OCDots">
              &lt;luizamaral306@gmail.com&gt;
            </a>
            <br />
            This software is under a
            <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GPL3</a>
            license. Have fun!
            <span style="font-size: 1.5em; vertical-align: baseline">ðŸ˜‰</span>
          </p>
        </div>
      </div>
    </div>
    <script>
      const size = 500;
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      ctx.canvas.width = size;
      ctx.canvas.height = size;

      const polygons = [
        // square
        [
          [0, 0],
          [0, size],
          [size, size],
          [size, 0],
          [0, 0],
        ],
        // L shape
        [
          [0, 0],
          [0, size],
          [size, size],
          [size, size / 2],
          [size / 2, size / 2],
          [size / 2, 0],
          [0, 0],
        ],
        // Triangle
        [
          [size / 2, 0],
          [0, size],
          [size, size],
          [size / 2, 0],
        ],
        // hexagon - good enough?
        [
          [size / 4, size / 10],
          [0, size / 2],
          [size / 4, (9 * size) / 10],
          [(3 * size) / 4, (9 * size) / 10],
          [size, size / 2],
          [(3 * size) / 4, size / 10],
          [size / 4, size / 10],
        ],
        // octagon
        [
          [(29 * size) / 100, 0],
          [0, (29 * size) / 100],
          [0, (71 * size) / 100],
          [(29 * size) / 100, size],
          [(71 * size) / 100, size],
          [size, (71 * size) / 100],
          [size, (29 * size) / 100],
          [(71 * size) / 100, 0],
          [(29 * size) / 100, 0],
        ],
        // Asteroid
        [
          [30, 30],
          [0, 180],
          [50, 410],
          [100, 490],
          [180, 390],
          [240, 490],
          [490, 450],
          [460, 420],
          [490, 320],
          [390, 120],
          [450, 20],
          [300, 0],
          [30, 30],
        ],
      ];

      const DEFAULTN = 24;

      let N,
        baseForce,
        drag,
        viscosity,
        attenuation,
        maxMomentum,
        points,
        momentum,
        polygon;

      resetControls();

      function draw() {
        ocdots.drawPolygonAndPoints(canvas, points, polygon);
        [points, momentum] = ocdots.movePoints({
          points,
          momentum,
          polygon,
          baseForce,
          drag,
          viscosity,
          maxMomentum,
          attenuation,
        });
        window.requestAnimationFrame(draw);
      }
      draw();

      function setValue(variable, value) {
        switch (variable) {
          case "baseForce":
            const v =
              Math.pow(10, Math.floor(value / 2)) * (value % 2 == 0 ? 1 : 5);

            baseForce = v;
            break;
          case "drag":
            drag = value;
            break;
          case "viscosity":
            viscosity = value;
            break;
          case "maxMomentum":
            maxMomentum = value;
            break;
        }
        updateRange();
      }
      function shakeem() {
        const shakeMax = 40;
        momentum = momentum.map((m) => [
          m[0] + shakeMax * Math.random() - shakeMax / 2,
          m[1] + shakeMax * Math.random() - shakeMax / 2,
        ]);
      }
      function reset() {
        points = ocdots.randomInPolygon(N, polygon);
        momentum = points.map(() => [0, 0]);
      }

      function resetControls() {
        N = DEFAULTN;
        baseForce = BASEFORCE;
        drag = DRAG;
        viscosity = VISCOSITY;
        attenuation = ATTENUATION;
        maxMomentum = MAXMOMENTUM;
        polygon = polygons[Math.floor(Math.random() * polygons.length)];
        points = ocdots.randomInPolygon(N, polygon);
        momentum = points.map(() => [0, 0]);
        document.getElementById("baseForce").value = 7;
        document.getElementById("drag").value = drag;
        document.getElementById("viscosity").value = viscosity;
        document.getElementById("maxMomentum").value = maxMomentum;
        document.getElementById("N").value = N;
        updateRange();
      }
      function updateRange() {
        document.getElementById("baseForceValue").innerHTML = baseForce;
        document.getElementById("dragValue").innerHTML = drag;
        document.getElementById("viscosityValue").innerHTML = viscosity;
        document.getElementById("maxMomentumValue").innerHTML = maxMomentum;
      }

      document.getElementById("N").addEventListener("change", (event) => {
        N = event.srcElement.value;
        reset();
      });
    </script>
  </body>
</html>
